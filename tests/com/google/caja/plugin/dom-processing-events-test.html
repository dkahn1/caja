<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
 "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>DOM Processing Events Test</title>
  <script src="bridal.js"></script>
  <script src="html4-defs.js"></script>
  <script src="html-emitter.js"></script>

  <script type="text/javascript">
  // Set up the HTML emitter.
  var IMPORTS___ = {};

  function getTestOutputContainer() {
    return document.getElementById('emitter-output');
  }

  // Define a function that can be called from a script block to
  // interleave an operation that modifies the DOM.
  function bar() {
    getTestOutputContainer().appendChild(document.createTextNode('BAR'));
  }

  // Called by code generated by DomProcessingEventsTestData
  function clearTestOutput() {
    var testOutputContainer = getTestOutputContainer();
    while (testOutputContainer.firstChild) {
      testOutputContainer.removeChild(testOutputContainer.firstChild);
    }
    IMPORTS___.htmlEmitter___ = new HtmlEmitter(testOutputContainer);
  }

  function escapeAttrib(s) {
    // Escaping '=' defangs many UTF-7 and SGML short-tag attacks.
    return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')
        .replace(/\"/g, '&quot;').replace(/=/g, '&#61;');
  }

  function getTestOutputInnerHTML() {
    var buf = [];
    for (var c = getTestOutputContainer().firstChild; c; c = c.nextSibling) {
      visit(c);
    }
    return buf.join('');

    function visit(node) {
      switch (node.nodeType) {
        case 1:
          var name = node.tagName.toLowerCase();
          buf.push('<', name);
          for (var atts = node.attributes, i = 0, n = atts.length; i < n; ++i) {
            var att = atts[i];
            var attName = att.name.toLowerCase();
            //console.log('attName=' + attName);
            if (!att.specified) { continue; }
            var value = (attName === 'style'
                         && 'string' === typeof node.style.cssText)
                ? node.style.cssText.toLowerCase().replace(/;\s*$/, '')
                : node.getAttribute(attName);
            buf.push(' ', attName, '="', escapeAttrib(String(value)), '"');
          }
          buf.push('>');
          if (node.firstChild || !(html4.ELEMENTS[name] & html4.eflags.EMPTY)) {
            for (var c = node.firstChild; c; c = c.nextSibling) { visit(c); }
            buf.push('</', name, '>');
          }
          break;
        case 3:
          buf.push(escapeAttrib(node.nodeValue));
          break;
        default: throw new Error();
      }
    }
  }
  </script>

  <script src="jsunit.js"></script>
  <script src="../../../../js/jsunit/2.2/jsUnitCore.js"></script>
  <script src="dpe-compiled.js"></script>
</head>

<body onload="jsunitRun()">
  <h1>DOM Processing Events Test</h1>

  <p>Tests for the java class <code>DomProcessingEvents</code> and the
  supporting javascript in <code>html-emitter.js</code>.  This loads
  tests generated by <code>DomProcessingEventsTestData</code> that
  includes test-cases built around the javascript generated by
  <code>DomProcessingEvents</code>.</p>

  <div id="emitter-output"><!-- filled by generated test cases. --></div>
</body>
</html>
