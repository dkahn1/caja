<html>
  <head>
    <title>Eval</title>

    <style type="text/css">
.result .type { float: right }
.result {
  font-family: monospace;
  white-space: pre;
  border-left: 6px solid #888;
  padding-left: 4px;
  margin: 2px
}
#caja-stack { white-space: pre; font-family: monospace }
    </style>

    <style type="text/css" id="caja-styles"></style>

    <script type="text/javascript" src="caja.js"></script>
    <script type="text/javascript" src="caja-debugmode.js"></script>
    <script type="text/javascript" src="unicode.js"></script>
    <script type="text/javascript" src="html4-defs.js"></script>
    <script type="text/javascript" src="html-sanitizer.js"></script>
    <script type="text/javascript" src="html-emitter.js"></script>
    <script type="text/javascript" src="domita.js"></script>

<script type="text/javascript">
var testImports;

function loadCaja(html) {
  var m = html.match(/^\s*<script[^\076]*>([\s\S]*?)<\/script[^\076]*>/i);
  if (m) {
    var script = m[1];

    testImports.clearHtml___();
    document.getElementById('caja-stacks').style.display = 'none';
    try {
      eval(script);
    } catch (ex) {
      var cajaStack = ex.cajaStack___ && ___.unsealCallerStack(ex.cajaStack___);
      if (cajaStack) {
        document.getElementById('caja-stacks').style.display = '';
        document.getElementById('caja-stack').appendChild(
            document.createTextNode(cajaStack.join('\n')));
      }
      throw ex;
    }
  } else {
    (typeof console !== 'undefined')
    && console.warn('Failed to eval cajoled output %s', html);
  }
}

(function () {
  testImports = ___.copy(___.sharedImports);
  caja.result = ___.simpleFunc(function (o) {
    var type = document.createElement('span');
    type.className = 'type';
    type.appendChild(document.createTextNode(typeString(o)));

    var entry = document.createElement('div');
    entry.className = 'result';
    entry.appendChild(type);
    entry.appendChild(document.createTextNode(repr(o)));

    document.getElementById('eval-results').appendChild(entry);
  });

  function typeString(o) {
    if (typeof o === 'object') {
      if (o === null) { return 'null'; }
      if (o.constructor.name) { return o.constructor.name; }
    }
    return typeof o;
  }

  function repr(o) {
    if ((typeof 'uneval') != 'undefined') { return uneval(o); }
    switch (typeof o) {
      case 'boolean': case 'number': case 'undefined':
        return String(o);
      default:
        return o && o.toSource() ? o.toSource() : String(o);
    }
  }

  ___.getNewModuleHandler().setImports(testImports);
  attachDocumentStub(
       '-xyz',
       {
         rewrite:
             function (uri, mimeType) {
               if (!/^https?:\/\//i.test(uri)) { return null; }
               return 'http://gadget-proxy/?url=' + encodeURIComponent(uri)
                   + '&mimeType=' + encodeURIComponent(mimeType);
             }
       },
       testImports);
  testImports.clearHtml___ = function () {
    document.getElementById('caja-html').innerHTML = (
        '<center style="color: gray">eval</center>');
    testImports.htmlEmitter___ = new HtmlEmitter(
        document.getElementById('caja-html'));
  };
})();

</script>
  </head>
  <body onload="testImports.clearHtml___()">
    <div id="eval-results"></div>
    <div id="caja-stacks" style="display:none">
      <hr>
      Errors
      <div id="caja-stack"></div>
    </div>
    <hr>
    <div id="caja-html" class="-xyz"></div>
  </body>
</html>
